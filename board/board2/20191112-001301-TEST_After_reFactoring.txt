The code is refactored now